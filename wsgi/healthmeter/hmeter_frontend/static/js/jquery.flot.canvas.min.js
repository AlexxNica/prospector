(function(f){var c={canvas:true};var b,e,d;var a=Object.prototype.hasOwnProperty;function g(j,i){var h=i.Canvas;if(b==null){e=h.prototype.getTextInfo,d=h.prototype.addText,b=h.prototype.render}h.prototype.render=function(){if(!j.getOptions().canvas){return b.call(this)}var l=this.context,k=this._textCache;l.save();l.textBaseline="middle";for(var w in k){if(a.call(k,w)){var u=k[w];for(var t in u){if(a.call(u,t)){var n=u[t],o=true;for(var v in n){if(a.call(n,v)){var m=n[v],r=m.positions,y=m.lines;if(o){l.fillStyle=m.font.color;l.font=m.font.definition;o=false}for(var q=0,s;s=r[q];q++){if(s.active){for(var p=0,x;x=s.lines[p];p++){l.fillText(y[p].text,x[0],x[1])}}else{r.splice(q--,1)}}if(r.length==0){delete n[v]}}}}}}}l.restore()};h.prototype.getTextInfo=function(t,w,o,r,l){if(!j.getOptions().canvas){return e.call(this,t,w,o,r,l)}var m,u,p,n;w=""+w;if(typeof o==="object"){m=o.style+" "+o.variant+" "+o.weight+" "+o.size+"px "+o.family}else{m=o}u=this._textCache[t];if(u==null){u=this._textCache[t]={}}p=u[m];if(p==null){p=u[m]={}}n=p[w];if(n==null){var k=this.context;if(typeof o!=="object"){var q=f("<div>&nbsp;</div>").css("position","absolute").addClass(typeof o==="string"?o:null).appendTo(this.getTextLayer(t));o={lineHeight:q.height(),style:q.css("font-style"),variant:q.css("font-variant"),weight:q.css("font-weight"),family:q.css("font-family"),color:q.css("color")};o.size=q.css("line-height",1).height();q.remove()}m=o.style+" "+o.variant+" "+o.weight+" "+o.size+"px "+o.family;n=p[w]={width:0,height:0,positions:[],lines:[],font:{definition:m,color:o.color}};k.save();k.font=m;var y=(w+"").replace(/<br ?\/?>|\r\n|\r/g,"\n").split("\n");for(var s=0;s<y.length;++s){var v=y[s],x=k.measureText(v);n.width=Math.max(x.width,n.width);n.height+=o.lineHeight;n.lines.push({text:v,width:x.width,height:o.lineHeight})}k.restore()}return n};h.prototype.addText=function(s,u,t,v,n,o,k,m,w){if(!j.getOptions().canvas){return d.call(this,s,u,t,v,n,o,k,m,w)}var l=this.getTextInfo(s,v,n,o,k),q=l.positions,A=l.lines;t+=l.height/A.length/2;if(w=="middle"){t=Math.round(t-l.height/2)}else{if(w=="bottom"){t=Math.round(t-l.height)}else{t=Math.round(t)}}if(!!(window.opera&&window.opera.version().split(".")[0]<12)){t-=2}for(var p=0,r;r=q[p];p++){if(r.x==u&&r.y==t){r.active=true;return}}r={active:true,lines:[],x:u,y:t};q.push(r);for(var p=0,z;z=A[p];p++){if(m=="center"){r.lines.push([Math.round(u-z.width/2),t])}else{if(m=="right"){r.lines.push([Math.round(u-z.width),t])}else{r.lines.push([Math.round(u),t])}}t+=z.height}}}f.plot.plugins.push({init:g,options:c,name:"canvas",version:"1.0"})})(jQuery);