(function(c){var e=10;var a=0.95;function d(y){var n=null,t=null,m=null,j=null,v=null,g=null,q=false,x=null;var h=[];y.hooks.processOptions.push(function(D,C){if(C.series.pie.show){C.grid.show=false;if(C.series.pie.label.show=="auto"){if(C.legend.show){C.series.pie.label.show=false}else{C.series.pie.label.show=true}}if(C.series.pie.radius=="auto"){if(C.series.pie.label.show){C.series.pie.radius=3/4}else{C.series.pie.radius=1}}if(C.series.pie.tilt>1){C.series.pie.tilt=1}else{if(C.series.pie.tilt<0){C.series.pie.tilt=0}}}});y.hooks.bindEvents.push(function(E,D){var C=E.getOptions();if(C.series.pie.show){if(C.grid.hoverable){D.unbind("mousemove").mousemove(r)}if(C.grid.clickable){D.unbind("click").click(k)}}});y.hooks.processDatapoints.push(function(G,C,E,F){var D=G.getOptions();if(D.series.pie.show){z(G,C,E,F)}});y.hooks.drawOverlay.push(function(D,E){var C=D.getOptions();if(C.series.pie.show){w(D,E)}});y.hooks.draw.push(function(E,C){var D=E.getOptions();if(D.series.pie.show){p(E,C)}});function z(E,C,D){if(!q){q=true;n=E.getCanvas();t=c(n).parent();m=E.getOptions();E.setData(B(E.getData()))}}function B(H){var F=0,D=0,J=0,C=m.series.pie.combine.color,I=[];for(var E=0;E<H.length;++E){var G=H[E].data;if(c.isArray(G)&&G.length==1){G=G[0]}if(c.isArray(G)){if(!isNaN(parseFloat(G[1]))&&isFinite(G[1])){G[1]=+G[1]}else{G[1]=0}}else{if(!isNaN(parseFloat(G))&&isFinite(G)){G=[1,+G]}else{G=[1,0]}}H[E].data=[G]}for(var E=0;E<H.length;++E){F+=H[E].data[0][1]}for(var E=0;E<H.length;++E){var G=H[E].data[0][1];if(G/F<=m.series.pie.combine.threshold){D+=G;J++;if(!C){C=H[E].color}}}for(var E=0;E<H.length;++E){var G=H[E].data[0][1];if(J<2||G/F>m.series.pie.combine.threshold){I.push(c.extend(H[E],{data:[[1,G]],color:H[E].color,label:H[E].label,angle:G*Math.PI*2/F,percent:G/(F/100)}))}}if(J>1){I.push({data:[[1,D]],color:C,label:m.series.pie.combine.label,angle:D*Math.PI*2/F,percent:D/(F/100)})}return I}function p(H,I){if(!t){return}var G=H.getPlaceholder().width(),F=H.getPlaceholder().height(),K=t.children().filter(".legend").children().width()||0;x=I;q=false;j=Math.min(G,F/m.series.pie.tilt)/2;g=F/2+m.series.pie.offset.top;v=G/2;if(m.series.pie.offset.left=="auto"){if(m.legend.position.match("w")){v+=K/2}else{v-=K/2}if(v<j){v=j}else{if(v>G-j){v=G-j}}}else{v+=m.series.pie.offset.left}var J=H.getData(),L=0;do{if(L>0){j*=a}L+=1;E();if(m.series.pie.tilt<=0.8){D()}}while(!C()&&L<e);if(L>=e){E();t.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>")}if(H.setSeries&&H.insertLegend){H.setSeries(J);H.insertLegend()}function E(){x.clearRect(0,0,G,F);t.children().filter(".pieLabel, .pieLabelBackground").remove()}function D(){var Q=m.series.pie.shadow.left;var R=m.series.pie.shadow.top;var N=10;var P=m.series.pie.shadow.alpha;var O=m.series.pie.radius>1?m.series.pie.radius:j*m.series.pie.radius;if(O>=G/2-Q||O*m.series.pie.tilt>=F/2-R||O<=N){return}x.save();x.translate(Q,R);x.globalAlpha=P;x.fillStyle="#000";x.translate(v,g);x.scale(1,m.series.pie.tilt);for(var M=1;M<=N;M++){x.beginPath();x.arc(0,0,O,0,Math.PI*2,false);x.fill();O-=M}x.restore()}function C(){var M=Math.PI*m.series.pie.startAngle;var R=m.series.pie.radius>1?m.series.pie.radius:j*m.series.pie.radius;x.save();x.translate(v,g);x.scale(1,m.series.pie.tilt);x.save();var Q=M;for(var O=0;O<J.length;++O){J[O].startAngle=Q;P(J[O].angle,J[O].color,true)}x.restore();if(m.series.pie.stroke.width>0){x.save();x.lineWidth=m.series.pie.stroke.width;Q=M;for(var O=0;O<J.length;++O){P(J[O].angle,m.series.pie.stroke.color,false)}x.restore()}u(x);x.restore();if(m.series.pie.label.show){return N()}else{return true}function P(U,S,T){if(U<=0||isNaN(U)){return}if(T){x.fillStyle=S}else{x.strokeStyle=S;x.lineJoin="round"}x.beginPath();if(Math.abs(U-Math.PI*2)>1e-9){x.moveTo(0,0)}x.arc(0,0,R,Q,Q+U/2,false);x.arc(0,0,R,Q+U/2,Q+U,false);x.closePath();Q+=U;if(T){x.fill()}else{x.stroke()}}function N(){var V=M;var U=m.series.pie.label.radius>1?m.series.pie.label.radius:j*m.series.pie.label.radius;for(var T=0;T<J.length;++T){if(J[T].percent>=m.series.pie.label.threshold*100){if(!S(J[T],V,T)){return false}}V+=J[T].angle}return true;function S(ai,X,ac){if(ai.data[0][1]==0){return true}var ak=m.legend.labelFormatter,aj,Z=m.series.pie.label.formatter;if(ak){aj=ak(ai.label,ai)}else{aj=ai.label}if(Z){aj=Z(aj,ai)}var Y=((X+ai.angle)+X)/2;var ah=v+Math.round(Math.cos(Y)*U);var af=g+Math.round(Math.sin(Y)*U)*m.series.pie.tilt;var aa="<span class='pieLabel' id='pieLabel"+ac+"' style='position:absolute;top:"+af+"px;left:"+ah+"px;'>"+aj+"</span>";t.append(aa);var ag=t.children("#pieLabel"+ac);var ab=(af-ag.height()/2);var W=(ah-ag.width()/2);ag.css("top",ab);ag.css("left",W);if(0-ab>0||0-W>0||F-(ab+ag.height())<0||G-(W+ag.width())<0){return false}if(m.series.pie.label.background.opacity!=0){var ad=m.series.pie.label.background.color;if(ad==null){ad=ai.color}var ae="top:"+ab+"px;left:"+W+"px;";c("<div class='pieLabelBackground' style='position:absolute;width:"+ag.width()+"px;height:"+ag.height()+"px;"+ae+"background-color:"+ad+";'></div>").css("opacity",m.series.pie.label.background.opacity).insertBefore(ag)}return true}}}}function u(C){if(m.series.pie.innerRadius>0){C.save();var D=m.series.pie.innerRadius>1?m.series.pie.innerRadius:j*m.series.pie.innerRadius;C.globalCompositeOperation="destination-out";C.beginPath();C.fillStyle=m.series.pie.stroke.color;C.arc(0,0,D,0,Math.PI*2,false);C.fill();C.closePath();C.restore();C.save();C.beginPath();C.strokeStyle=m.series.pie.stroke.color;C.arc(0,0,D,0,Math.PI*2,false);C.stroke();C.closePath();C.restore()}}function f(F,G){for(var H=false,E=-1,C=F.length,D=C-1;++E<C;D=E){((F[E][1]<=G[1]&&G[1]<F[D][1])||(F[D][1]<=G[1]&&G[1]<F[E][1]))&&(G[0]<(F[D][0]-F[E][0])*(G[1]-F[E][1])/(F[D][1]-F[E][1])+F[E][0])&&(H=!H)}return H}function s(H,I){var P=y.getData(),K=y.getOptions(),J=K.series.pie.radius>1?K.series.pie.radius:j*K.series.pie.radius,O,M;for(var T=0;T<P.length;++T){var Q=P[T];if(Q.pie.show){x.save();x.beginPath();x.moveTo(0,0);x.arc(0,0,J,Q.startAngle,Q.startAngle+Q.angle/2,false);x.arc(0,0,J,Q.startAngle+Q.angle/2,Q.startAngle+Q.angle,false);x.closePath();O=H-v;M=I-g;if(x.isPointInPath){if(x.isPointInPath(H-v,I-g)){x.restore();return{datapoint:[Q.percent,Q.data],dataIndex:0,series:Q,seriesIndex:T}}}else{var U=J*Math.cos(Q.startAngle),R=J*Math.sin(Q.startAngle),F=J*Math.cos(Q.startAngle+Q.angle/4),D=J*Math.sin(Q.startAngle+Q.angle/4),N=J*Math.cos(Q.startAngle+Q.angle/2),L=J*Math.sin(Q.startAngle+Q.angle/2),V=J*Math.cos(Q.startAngle+Q.angle/1.5),S=J*Math.sin(Q.startAngle+Q.angle/1.5),G=J*Math.cos(Q.startAngle+Q.angle),E=J*Math.sin(Q.startAngle+Q.angle),W=[[0,0],[U,R],[F,D],[N,L],[V,S],[G,E]],C=[O,M];if(f(W,C)){x.restore();return{datapoint:[Q.percent,Q.data],dataIndex:0,series:Q,seriesIndex:T}}}x.restore()}}return null}function r(C){i("plothover",C)}function k(C){i("plotclick",C)}function i(C,I){var D=y.offset();var F=parseInt(I.pageX-D.left);var E=parseInt(I.pageY-D.top);var K=s(F,E);if(m.grid.autoHighlight){for(var G=0;G<h.length;++G){var H=h[G];if(H.auto==C&&!(K&&H.series==K.series)){o(H.series)}}}if(K){l(K.series,C)}var J={pageX:I.pageX,pageY:I.pageY};t.trigger(C,[J,K])}function l(D,E){var C=A(D);if(C==-1){h.push({series:D,auto:E});y.triggerRedrawOverlay()}else{if(!E){h[C].auto=false}}}function o(D){if(D==null){h=[];y.triggerRedrawOverlay()}var C=A(D);if(C!=-1){h.splice(C,1);y.triggerRedrawOverlay()}}function A(E){for(var C=0;C<h.length;++C){var D=h[C];if(D.series==E){return C}}return -1}function w(G,H){var D=G.getOptions();var F=D.series.pie.radius>1?D.series.pie.radius:j*D.series.pie.radius;H.save();H.translate(v,g);H.scale(1,D.series.pie.tilt);for(var C=0;C<h.length;++C){E(h[C].series)}u(H);H.restore();function E(I){if(I.angle<=0||isNaN(I.angle)){return}H.fillStyle="rgba(255, 255, 255, "+D.series.pie.highlight.opacity+")";H.beginPath();if(Math.abs(I.angle-Math.PI*2)>1e-9){H.moveTo(0,0)}H.arc(0,0,F,I.startAngle,I.startAngle+I.angle/2,false);H.arc(0,0,F,I.startAngle+I.angle/2,I.startAngle+I.angle,false);H.closePath();H.fill()}}}var b={series:{pie:{show:false,radius:"auto",innerRadius:0,startAngle:3/2,tilt:1,shadow:{left:5,top:15,alpha:0.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(f,g){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+g.color+";'>"+f+"<br/>"+Math.round(g.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:0.5}}}};c.plot.plugins.push({init:d,options:b,name:"pie",version:"1.1"})})(jQuery);